{"version":3,"file":"http.js","sources":["utils/request/http.js"],"sourcesContent":["// utils/http.js\r\n\r\n// 默认配置\r\nconst defaultConfig = {\r\n\turl: '',\r\n\tmethod: 'GET',\r\n\ttimeout: 10000,\r\n\tloading: true\r\n}\r\n\r\nclass Http {\r\n\tconstructor(config) {\r\n\t\tthis.baseURL = config.baseURL\r\n\t\tthis.interceptor = {}\r\n\t}\r\n\r\n\t// 设置拦截器\r\n\tsetInterceptor(interceptor) {\r\n\t\tthis.interceptor = interceptor\r\n\t}\r\n\r\n\t// 核心请求方法\r\n\tasync request(config) {\r\n\t\t// 合并配置\r\n\t\tlet mergedConfig = {\r\n\t\t\t...defaultConfig,\r\n\t\t\t...config\r\n\t\t}\r\n\r\n\t\t// 请求拦截\r\n\t\tif (typeof this.interceptor.request === 'function') {\r\n\t\t\tmergedConfig = this.interceptor.request(mergedConfig)\r\n\t\t}\r\n\r\n\t\t// 处理URL\r\n\t\tlet url = this.baseURL + mergedConfig.url\r\n\t\tif (mergedConfig.params) {\r\n\t\t\tconst params = new URLSearchParams(mergedConfig.params).toString()\r\n\t\t\turl += `?${params}`\r\n\t\t}\r\n\r\n\t\t// 显示加载中\r\n\t\t// if (mergedConfig.loading) {\r\n\t\t// \tuni.showLoading({\r\n\t\t// \t\ttitle: '加载中...',\r\n\t\t// \t\tmask: true\r\n\t\t// \t})\r\n\t\t// }\r\n\r\n\t\ttry {\r\n\t\t\t// 如果是 FormData 请求，构造 application/x-www-form-urlencoded 数据\r\n\t\t\tlet requestData = mergedConfig.data || {}\r\n\r\n\t\t\tif (mergedConfig.isFormData) {\r\n\t\t\t\tconst formData = {}\r\n\t\t\t\tfor (const key in requestData) {\r\n\t\t\t\t\tif (requestData.hasOwnProperty(key)) {\r\n\t\t\t\t\t\tformData[key] = String(requestData[key]) // 转为字符串\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\trequestData = formData\r\n\t\t\t}\r\n\r\n\t\t\t// 打印调试信息\r\n\t\t\tconsole.log('发送请求:', {\r\n\t\t\t\turl,\r\n\t\t\t\tmethod: mergedConfig.method,\r\n\t\t\t\tdata: requestData,\r\n\t\t\t\theader: mergedConfig.header\r\n\t\t\t})\r\n\r\n\t\t\tconst response = await uni.request({\r\n\t\t\t\turl,\r\n\t\t\t\tmethod: mergedConfig.method,\r\n\t\t\t\tdata: requestData,\r\n\t\t\t\theader: mergedConfig.header,\r\n\t\t\t\ttimeout: mergedConfig.timeout\r\n\t\t\t})\r\n\r\n\t\t\t// 响应拦截\r\n\t\t\tlet res = response\r\n\t\t\tif (typeof this.interceptor.response === 'function') {\r\n\t\t\t\tres = this.interceptor.response(response)\r\n\t\t\t}\r\n\r\n\t\t\t// 处理业务逻辑\r\n\t\t\tif (res.statusCode === 200) {\r\n\t\t\t\treturn res.data\r\n\t\t\t} else {\r\n\t\t\t\tconsole.error('接口返回异常:', res)\r\n\t\t\t\treturn Promise.reject(res.data)\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\t// 统一错误处理\r\n\t\t\tconsole.error('请求异常:', error)\r\n\t\t\tthis.handleError(error)\r\n\t\t\treturn Promise.reject(error)\r\n\t\t} finally {\r\n\t\t\tif (mergedConfig.loading) {\r\n\t\t\t\tuni.hideLoading()\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// 错误处理\r\n\thandleError(error) {\r\n\t\tconst errMsg = error.errMsg || ''\r\n\r\n\t\tif (errMsg.includes('timeout')) {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '请求超时',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t} else if (errMsg.includes('abort')) {\r\n\t\t\tconsole.log('请求被取消')\r\n\t\t} else {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '网络异常，请稍后重试',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\t// 快捷方法\r\n\tget(url, params, config) {\r\n\t\treturn this.request({\r\n\t\t\t...config,\r\n\t\t\turl,\r\n\t\t\tmethod: 'GET',\r\n\t\t\tparams\r\n\t\t})\r\n\t}\r\n\r\n\tpost(url, data, config) {\r\n\t\treturn this.request({\r\n\t\t\t...config,\r\n\t\t\turl,\r\n\t\t\tmethod: 'POST',\r\n\t\t\tdata\r\n\t\t})\r\n\t}\r\n\r\n\tpostFormData(url, data, config) {\r\n\t\treturn this.request({\r\n\t\t\t...config,\r\n\t\t\turl,\r\n\t\t\tmethod: 'POST',\r\n\t\t\tdata,\r\n\t\t\tisFormData: true\r\n\t\t})\r\n\t}\r\n\r\n\tput(url, data, config) {\r\n\t\treturn this.request({\r\n\t\t\t...config,\r\n\t\t\turl,\r\n\t\t\tmethod: 'PUT',\r\n\t\t\tdata\r\n\t\t})\r\n\t}\r\n\r\n\tdelete(url, params, config) {\r\n\t\treturn this.request({\r\n\t\t\t...config,\r\n\t\t\turl,\r\n\t\t\tmethod: 'DELETE',\r\n\t\t\tparams\r\n\t\t})\r\n\t}\r\n}\r\n\r\n// 创建实例\r\nexport const http = new Http({\r\n\tbaseURL: 'https://k1sw.wiselink.net.cn' // 你的基础地址\r\n})\r\n\r\n// 快捷方法挂载到实例上（可选）\r\nhttp.get = (url, params, config) => http.request({\r\n\t...config,\r\n\turl,\r\n\tmethod: 'GET',\r\n\tparams\r\n})\r\nhttp.post = (url, data, config) => http.request({\r\n\t...config,\r\n\turl,\r\n\tmethod: 'POST',\r\n\tdata\r\n})\r\nhttp.postFormData = (url, data, config) => http.request({\r\n\t...config,\r\n\turl,\r\n\tmethod: 'POST',\r\n\tdata,\r\n\tisFormData: true\r\n})\r\nhttp.put = (url, data, config) => http.request({\r\n\t...config,\r\n\turl,\r\n\tmethod: 'PUT',\r\n\tdata\r\n})\r\nhttp.delete = (url, params, config) => http.request({\r\n\t...config,\r\n\turl,\r\n\tmethod: 'DELETE',\r\n\tparams\r\n})\r\n\r\n// 设置拦截器示例\r\nhttp.setInterceptor({\r\n\trequest: (config) => {\r\n\t\t// 添加全局header（例如token）\r\n\t\tconst token = uni.getStorageSync('token')\r\n\t\tlet header = config.header || {}\r\n\r\n\t\tif (token) {\r\n\t\t\theader['token'] = token\r\n\t\t}\r\n\r\n\t\t// 设置 Content-Type\r\n\t\tif (config.isFormData) {\r\n\t\t\theader['content-type'] = 'application/x-www-form-urlencoded'\r\n\t\t} else {\r\n\t\t\theader['content-type'] = 'application/json'\r\n\t\t}\r\n\r\n\t\tconfig.header = header\r\n\t\treturn config\r\n\t},\r\n\tresponse: (response) => {\r\n\t\t// 处理响应状态码\r\n\t\tif (response.data.code === 9000) {\r\n\t\t\t// token过期处理\r\n\t\t\tuni.navigateTo({\r\n\t\t\t\turl: '/pages/login/login'\r\n\t\t\t})\r\n\t\t}\r\n\t\treturn response\r\n\t}\r\n})"],"names":["uni"],"mappings":"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"}