if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((n=>t.resolve(e()).then((()=>n))),(n=>t.resolve(e()).then((()=>{throw n}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...n){uni.__log__?uni.__log__(e,t,...n):console[e].apply(console,[...n,t])}function n(e,t){a(e),a(t)}function i(e,i,s){var r={"content-type":"application/x-www-form-urlencoded"},c=getApp().globalData.data.userInfo;return t("log","at utils/app-util.js:178",getApp()),o(c)||(r.username=c.username,r.token=c.token,r.timestamp=Date.parse(new Date)),n(e,i),uni.request({timeout:2e4,url:e,data:i,header:r,method:"POST",success:function(e){s(e),a(e.data)},fail:function(e){a(e),s(!1)}})}function o(e){return void 0===e||null==e||""==e||!e}function a(e){getApp().globalData.data.isDebug&&t("log","at utils/app-util.js:476",e)}const s={byPostFormData:function(e,t,i,s){var r={};r["content-type"]=t;var c=getApp().globalData.data.userInfo;return o(c)||(r.username=c.username,r.token=c.token,r.timestamp=Date.parse(new Date)),n(e,i),uni.request({timeout:2e4,url:e,data:i,header:r,method:"POST",success:function(e){s(e),a(e.data)},fail:function(e){a(e),s(!1)}})},showToast:function(e){uni.showToast({title:e,icon:"none"})},showLoading:function(e){uni.showLoading({title:e,mask:!0})},hideLoading:function(){uni.hideLoading()},showSucessToast:function(e){uni.showToast({title:e,icon:"success"})},showModal:function(e,t,n){uni.showModal({title:"提示",content:e,showCancel:t,success:function(e){e.confirm?n(!0):e.cancel&&n(!1)}})},getSystemInfo:function(e){uni.getSystemInfo({success:function(t){e(t)}})},getSystemInfoComplete:function(e,t){uni.getSystemInfo({success:function(t){e(t)},complete:function(){t()}})},getWXLocation:function(e){uni.getLocation({type:"gcj02",success:function(t){e(t)},fail:function(t){e(t)}})},byGet:function(e,i,s){var r={"content-type":"application/x-www-form-urlencoded"},c=getApp().globalData.data.userInfo;return t("log","at utils/app-util.js:143",getApp()),o(c)||(r.username=c.username,r.token=c.token,r.timestamp=Date.parse(new Date)),n(e,i),i.version=getApp().globalData.data.version,uni.request({url:e,data:i,header:r,success:function(e){s(e),a(e.data)},fail:function(e){s(e)}})},byPost:i,byPostJson:function(e,t,i){var s={"content-type":"application/json"},r=getApp().globalData.data.userInfo;return o(r)||(s.username=r.username,s.token=r.token,s.timestamp=Date.parse(new Date)),n(e,t),uni.request({timeout:2e4,url:e,data:t,header:s,method:"POST",success:function(e){i(e),a(e.data)},fail:function(e){a(e),i(!1)}})},SCOPE_TYPE:{SCOPE_LOCATION:"scope.userLocation",SCOPE_CAMERA:"scope.camera",SCOPE_BLUETOOTH:"scope.bluetooth"},getAuthState:function(e,t){uni.getSetting({success(n){n.authSetting[e]?t(!0):t(!1)}})},authorize:function(e,t){uni.authorize({scope:e,success(){t(!0)},fail(){t(!1)}})},getStorage:function(e,t){e?uni.getStorage({key:e,success:function(e){t(e.data)},fail:function(e){t(!1)}}):t("")},setStorage:function(e,t,n){uni.setStorage({key:e,data:t,success(){n(!0)},fail(){n(!1)}})},clearStorage:function(){uni.clearStorage()},getNetworkType:function(e){uni.getNetworkType({success:function(t){e("none"!=t.networkType)},fail:function(t){e(!0)}})},onNetworkStatusChange:function(e){uni.onNetworkStatusChange((function(t){e(t)}))},openLocation:function(e,t,n){uni.openLocation({latitude:e,longitude:t,scale:n||18})},isEmpty:o,isNumber:function(e){return!!/^[0-9]*$/.test(e)},navigateTo:function(e){o(e)||uni.navigateTo({url:e})},SHOW_TYPE:{IDCARD_TYPE:1,DRIVINGCARD_TYPE:2,ALL_TYPE:3},chooseImageDefault:function(e){uni.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success(t){e(t)},fail(t){e(!1)}})},takePhoto:function(e,t){e.takePhoto({quality:"high",success:function(e){t(e)},fail:function(){t(!1)}})},getImageInfo:function(e,t){uni.getImageInfo({src:e,success:function(e){t(e)},fail:function(){t(!1)}})},uploadFile:function(e,t,i,o){return n(e,i),uni.uploadFile({url:e,filePath:t,name:"Filedata",header:{"content-type":"multipart/form-data"},formData:i,success(e){a(e),o(e)},fail:function(){o(!1)}})},uploadFile2:function(e,s,r,c,l){if(!o(r)){var u={"content-type":"multipart/form-data"},d=getApp().globalData.data.userInfo;return o(d)||(u.username=d.username,u.token=d.token,u.timestamp=Date.parse(new Date)),n(e,c),uni.uploadFile({url:e,filePath:r,name:s,header:u,formData:c,success(e){a(e),l(e)},fail:function(){l(!1),t("log","at utils/app-util.js:451","上传发生错误")}})}i(e,c,l)},jsDateFormatter:function(e){var t=e.getMonth()+1,n=e.getDate();return t>=1&&t<=9&&(t="0"+t),n>=0&&n<=9&&(n="0"+n),e.getFullYear()+"-"+t+"-"+n+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()},log:a,isLogin:function(){return!o(getApp().globalData.data.userInfo)}};function r(e){var t=new Date;return("MM-dd HH:mm:ss SSS "+e+"\n").replace("yyyy",t.getFullYear()).replace("MM",c(t.getMonth()+1)).replace("dd",c(t.getDate())).replace("HH",c(t.getHours())).replace("mm",c(t.getMinutes())).replace("ss",c(t.getSeconds())).replace("SSS",t.getMilliseconds())}function c(e){return e.toString().length<2?"0"+e:e}function l(e){try{var n=uni.getStorageSync("log");if(n)try{var i=n+e;i.length>5120?uni.setStorageSync("log",i.substring(4096)):uni.setStorageSync("log",i)}catch(o){t("log","at utils/logger.js:71","CatchClause",o),t("log","at utils/logger.js:72","CatchClause",o)}else try{uni.setStorageSync("log",e)}catch(o){t("log","at utils/logger.js:78","CatchClause",o),t("log","at utils/logger.js:79","CatchClause",o)}}catch(o){t("log","at utils/logger.js:83","CatchClause",o),t("log","at utils/logger.js:84","CatchClause",o)}}const u={e:function(e,n){n?t("log","at utils/logger.js:6",e,n):t("log","at utils/logger.js:8",e),l(r(n?e+" "+n:e))},clear:function(){uni.setStorage({key:"log",data:""})},getDateString:function(e){var t=new Date(e);return"yyyy-MM-dd HH:mm:ss".replace("yyyy",t.getFullYear()).replace("MM",c(t.getMonth()+1)).replace("dd",c(t.getDate())).replace("HH",c(t.getHours())).replace("mm",c(t.getMinutes())).replace("ss",c(t.getSeconds())).replace("SSS",t.getMilliseconds())}};function d(e,t){var n=new Array(2);if(t)for(var i=n.length-1;i>=0;i--)n[i]=255&e,e>>=8;else for(i=0;i<n.length;i++)n[i]=255&e,e>>=8;return n}function g(e,t,n,i){return 255&i|(255&n)<<8|(255&t)<<16|(255&e)<<24}getApp();const f={hexStringToArrayBuffer:function(e){return new Uint8Array(e.match(/[\da-f]{2}/gi).map((function(e){return parseInt(e,16)})))},hexStringToArray:function(e){var t=new Uint8Array(e.match(/[\da-f]{2}/gi).map((function(e){return parseInt(e,16)})));return t.length>1?Array.apply(new Array,t):t},string2buffer:function(e){let t="";for(let n=0;n<e.length;n++)""===t?t=e.charCodeAt(n).toString(16):t+=e.charCodeAt(n).toString(16);return new Uint8Array(t.match(/[\da-f]{2}/gi).map((function(e){return parseInt(e,16)}))).buffer},stringToBytes:function(e){for(var t,n,i=[],o=0;o<e.length;o++){t=e.charCodeAt(o),n=[];do{n.push(255&t),t>>=8}while(t);i=i.concat(n.reverse())}return i},shortToSingleBytes:function(e,t){var n=new Array(1);return n[0]=255&e,n},shortToBytes:d,intToBytes:function(e,t){var n=new Array(4);if(t)for(var i=n.length-1;i>=0;i--)n[i]=255&e,e>>=8;else for(i=0;i<n.length;i++)n[i]=255&e,e>>=8;return n},crcEncrypt:function(e,t,n){var i=function(e,t,n,i){for(var o=65535,a=0;a<i;a++)o=o>>>8^e[255&(o^t[n+a])];return o}(e,t,0,t.length),o=d(i,!1),a=d(t.length+o.length,!0);return n.concat(a).concat(t).concat(o)},buf2hex:function(e){return Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join("")},bytesToInt:g,bytesToShort:function(e,t){return g(0,0,e,t)},converTude2Double:function(e,t){return(255&e[t])+((255&e[t+1])+(255&e[t+2])/100+(255&e[t+3])/1e4)/60},getShortWith:function(e,t){if(null==e)return 0;var n=e.length,i=0;if(t)for(o=0;o<n;o++)i<<=8,i|=255&e[o];else for(var o=n-1;o>=0;o--)i<<=8,i|=255&e[o];return i},hexCharCodeToStr:function(e){var n,i=e.trim(),o="0x"===i.substr(0,2).toLowerCase()?i.substr(2):i,a=o.length;if(a%2!=0)return t("log","at utils/byte-util.js:231","Illegal Format ASCII Code!"),"";for(var s=[],r=0;r<a;r+=2)n=parseInt(o.substr(r,2),16),s.push(String.fromCharCode(n));return s.join("")},buf2string:function(e){for(var t=Array.prototype.map.call(new Uint8Array(e),(e=>e)),n="",i=0;i<t.length;i++)n+=String.fromCharCode(t[i]);return n},crcEncrypt_KTQUpgrade:function(e){for(var t=0,n=0;n<128;n++){t^=e[3+n]<<8;for(var i=0;i<8;i++)32768&t?t=t<<1^4129:t<<=1}return d(t,!0)}};var h="";const m="6E400001";var p="";const E="6E400001";var y="";const v="6E400002";var T="";const S="6E400003";var B="";const A="6E400004";var L,O,_="6E400001-B5A3-F393-E0A9-E50E24DCCA9E",C="6E400001-B5A3-F393-E0A9-E50E24DCCA9E",I="6E400003-B5A3-F393-E0A9-E50E24DCCA9E",D="6E400002-B5A3-F393-E0A9-E50E24DCCA9E",U="6E400004-B5A3-F393-E0A9-E50E24DCCA9E",w="",F="",N=!1,x=!1,V=!1,b=!1,k={BLUETOOTH_ERROR:-2,BLUETOOTH_CONNECT_FAILED:-1,BLUETOOTH_CONNECT_SUCESS:0,BLUETOOTH_ADAPTER_UNAVAILABLE:1,BLUETOOTH_DEVICES_DISCOVERY_FAILD:2,BLUETOOTH_SEND_FREQUENTLY:3,BLUETOOTH_PRE_EXECUTE:4,BLUETOOTH_NOT_FOUND:5,BLUETOOTH_UNSUPPORTED:6,BLUETOOTH_SEND_FAILED:7,BLUETOOTH_NO_RESPONSE:8};function j(){const e=new Date;return`${String(e.getMonth()+1).padStart(2,"0")}`+"/"+`${String(e.getDate()).padStart(2,"0")}`+" "+`${String(e.getHours()).padStart(2,"0")}`+":"+`${String(e.getMinutes()).padStart(2,"0")}`+":"+`${String(e.getSeconds()).padStart(2,"0")}`+"."+`${String(e.getMilliseconds()).padStart(3,"0")}`}function P(e){const t=uni.getDeviceInfo();var n=t.brand,i=t.platform,o=t.system;u.e("手机型号:"+n+",系统信息:"+i+",系统版本:"+o),e(!0)}function H(e){var n;V?N?e(N):K((function(t){R(t.available,t.discovering),e(t.available)})):(n=function(t){t?K((function(t){R(t.available,t.discovering),e(t.available)})):e(t)},uni.openBluetoothAdapter({success:function(e){t("log","at utils/BleKeyFun-utils-single.js:194",e),V=!0,n(!0)},fail:function(e){t("log","at utils/BleKeyFun-utils-single.js:199",e),V=!1,R(!1,!1),n(!1)}}))}function R(e,t){N=e,x=t}function K(e){uni.getBluetoothAdapterState({success:function(t){e(t)},fail:function(t){e(t)}})}function M(){uni.onBluetoothAdapterStateChange((function(e){u.e("adapterState changed, now is",e),R(e.available,e.discovering)}))}function q(){uni.createBLEConnection({deviceId:F,success:function(e){h="",y="",p="",T="",uni.getBLEDeviceServices({deviceId:F,success:function(e){for(var n=0;n<e.services.length;n++)t("log","at utils/BleKeyFun-utils-single.js:407",e),-1!=e.services[n].uuid.indexOf(m)&&(h=e.services[n].uuid),-1!=e.services[n].uuid.indexOf(E)&&(p=e.services[n].uuid);u.e("device设备的读服务id:",h),u.e("device设备的写服务id:",p),""==h||""==p||""!=y&&""!=T||uni.getBLEDeviceCharacteristics({deviceId:F,serviceId:h,success:function(e){for(var n=0;n<e.characteristics.length;n++)-1!=e.characteristics[n].uuid.indexOf(v)&&(y=e.characteristics[n].uuid);u.e("device设备的写特征值id:"+y),""==T&&uni.getBLEDeviceCharacteristics({deviceId:F,serviceId:p,success:function(e){for(var n=0;n<e.characteristics.length;n++)-1!=e.characteristics[n].uuid.indexOf(S)&&(T=e.characteristics[n].uuid),-1!=e.characteristics[n].uuid.indexOf(A)&&(B=e.characteristics[n].uuid);u.e("device设备的读特征值id:"+T),u.e("device设备的读Random特征值id:"+B),""!=T&&uni.notifyBLECharacteristicValueChange({deviceId:F,serviceId:p,characteristicId:T,state:!0,success:function(e){t("log","at utils/BleKeyFun-utils-single.js:495",e),s.getSystemInfoComplete((function(e){var t=e.system,n=t.indexOf(" "),i=t.indexOf(".");-1!=n&&-1!=i&&(t.substring(0,n),t.substring(n+1,i+2))}),(function(){uni.setBLEMTU({deviceId:F,mtu:240,success:function(e){t("log","at utils/BleKeyFun-utils-single.js:511","MTU modify success")},fail:function(e){t("log","at utils/BleKeyFun-utils-single.js:514","MTU modify fail")}})}))},fail:function(e){t("log","at utils/BleKeyFun-utils-single.js:522",e)}}),""!=B&&setTimeout((()=>{uni.readBLECharacteristicValue({deviceId:F,serviceId:p,characteristicId:B,state:!0,success:function(e){t("log","at utils/BleKeyFun-utils-single.js:571",e)},fail:function(e){t("log","at utils/BleKeyFun-utils-single.js:574",e)}})}),100)},fail:function(e){t("log","at utils/BleKeyFun-utils-single.js:464",e)}})},fail:function(e){t("log","at utils/BleKeyFun-utils-single.js:614",e)}})}})},fail:function(e){t("log","at utils/BleKeyFun-utils-single.js:276",e),L(k.BLUETOOTH_CONNECT_FAILED)}})}function Y(){uni.getBLEDeviceServices({deviceId:F,success:function(e){u.e("device设备的读服务id:",C),u.e("device设备的写服务id:",_),uni.getBLEDeviceCharacteristics({deviceId:F,serviceId:C,success:function(e){u.e("device设备的写特征值id:"+D),uni.getBLEDeviceCharacteristics({deviceId:F,serviceId:_,success:function(e){u.e("device设备的读特征值id:"+I),u.e("device设备的读Random特征值id:"+U),uni.notifyBLECharacteristicValueChange({deviceId:F,serviceId:_,characteristicId:I,state:!0,success:function(e){s.getSystemInfoComplete((function(e){var t=e.system,n=t.indexOf(" "),i=t.indexOf(".");-1!=n&&-1!=i&&(t.substring(0,n),t.substring(n+1,i+2))}),(function(){uni.setBLEMTU({deviceId:F,mtu:240,success:function(e){t("log","at utils/BleKeyFun-utils-single.js:549","MTU modify success")},fail:function(e){t("log","at utils/BleKeyFun-utils-single.js:552","MTU modify fail")}})}))},fail:function(e){t("log","at utils/BleKeyFun-utils-single.js:559",e)}}),uni.readBLECharacteristicValue({deviceId:F,serviceId:_,characteristicId:U,state:!0,success:function(e){t("log","at utils/BleKeyFun-utils-single.js:586",e)},fail:function(e){t("log","at utils/BleKeyFun-utils-single.js:589",e)}})},fail:function(e){t("log","at utils/BleKeyFun-utils-single.js:480",e)}})},fail:function(e){t("log","at utils/BleKeyFun-utils-single.js:628",e)}})}})}function $(){uni.onBluetoothDeviceFound((function(e){""!=e.devices[0].name&&u.e("device found:"+e.devices[0].name),w==e.devices[0].localName&&(t("log","at utils/BleKeyFun-utils-single.js:360",e),F=e.devices[0].deviceId,z(w),uni.onBLEConnectionStateChange((function(e){u.e(`device ${e.deviceId} state has changed, connected: ${e.connected}`),b=e.connected,null!=L&&L(b?k.BLUETOOTH_CONNECT_SUCESS:k.BLUETOOTH_ERROR),e.deviceId==F&&1==e.connected&&x&&G()})),M(),uni.onBLECharacteristicValueChange((function(e){var n=e.value,i=f.buf2hex(n),o=f.hexStringToArray(i);const a=j();-1!=e.characteristicId.indexOf(A)?(t("log","at utils/BleKeyFun-utils-single.js:644","随机指令接收:"+a+"  数据:"+i),u.e("随机指令数据:"+i,!1,!1,!0),O(0,o,f.hexCharCodeToStr(i),i)):(t("log","at utils/BleKeyFun-utils-single.js:648","通知指令接收:"+a+"  数据:"+i),u.e("通知指令接收:"+i,!1,!1,!0),O(1,o,f.hexCharCodeToStr(i),i))})),q())}))}function W(){M(),uni.onBLECharacteristicValueChange((function(e){var n=e.value,i=f.buf2hex(n),o=f.hexStringToArray(i);const a=j();e.characteristicId==U?(t("log","at utils/BleKeyFun-utils-single.js:663","随机指令接收:"+a+"  数据:"+i),u.e("随机指令数据:"+i,!1,!1,!0),O(0,o,f.hexCharCodeToStr(i),i)):(t("log","at utils/BleKeyFun-utils-single.js:667","通知指令接收:"+a+"  数据:"+i),u.e("通知指令接收:"+i,!1,!1,!0),O(1,o,f.hexCharCodeToStr(i),i))})),Y()}function G(){uni.stopBluetoothDevicesDiscovery({success:function(e){t("log","at utils/BleKeyFun-utils-single.js:383",e),x=!1,u.e("stopScanBle-true discovering:"+x)},fail:function(e){t("log","at utils/BleKeyFun-utils-single.js:388",e),x=!1,u.e("stopScanBle-false discovering:"+x)}})}function z(e){t("log","at utils/BleKeyFun-utils-single.js:861","saveBLEDeviceInfo");var n={};n.deviceId=F,n.readServiceUUID=p,n.writeServiceUUID=h,n.readCharacUUID=T,n.writeCharacUUID=y,n.randomServiceUUID=p,n.randomCharacUUID=B;var i=JSON.stringify(n);uni.setStorage({key:e,data:i,success:function(){}})}const J={connectBLE:function(e,n,i){!function(e,n,i,o){b||P((function(o){o?H((function(o){o?(!function(e,t,n,i,o){L!=i&&(L=i),O!=o&&(O=o),w!=e&&(w=e),$()}(e,0,0,n,i),uni.startBluetoothDevicesDiscovery({success:function(e){t("log","at utils/BleKeyFun-utils-single.js:339",e),x=e.isDiscovering},fail:function(e){t("log","at utils/BleKeyFun-utils-single.js:343",e),x=e.isDiscovering,L(k.BLUETOOTH_ERROR),L(k.BLUETOOTH_DEVICES_DISCOVERY_FAILD)}})):(L(k.BLUETOOTH_ERROR),L(k.BLUETOOTH_ADAPTER_UNAVAILABLE))})):(n(k.BLUETOOTH_ERROR),n(k.BLUETOOTH_UNSUPPORTED))}))}(e,n,i)},releaseBle:function(){w="",x&&(u.e("停止扫描"),G()),b&&(u.e("断开连接"),uni.closeBLEConnection({deviceId:F,success:function(e){t("log","at utils/BleKeyFun-utils-single.js:319",e),b=!1},fail:function(e){t("log","at utils/BleKeyFun-utils-single.js:323",e)}})),V&&(u.e("关闭适配器"),uni.closeBluetoothAdapter({success:function(e){t("log","at utils/BleKeyFun-utils-single.js:245",e),V=!1},fail:function(e){t("log","at utils/BleKeyFun-utils-single.js:249",e)}})),u.e("释放deviceId"),F="",u.e("关闭连接事件监听"),uni.offBLEConnectionStateChange(),u.e("关闭特征变化监听"),uni.offBLECharacteristicValueChange()},dispatcherSend2:function(e,n){!function(e,n){var i=e;setTimeout((function(){var e;(function(e,n){uni.writeBLECharacteristicValue({deviceId:F,serviceId:C,characteristicId:D,value:e,success:function(e){n(!0)},fail:function(e){t("log","at utils/BleKeyFun-utils-single.js:687",e),n(!1)}})})(e=i,(function(n){const i=j();var o=e,a=f.buf2hex(o);n?(t("log","at utils/BleKeyFun-utils-single.js:834","指令发送成功:"+i+"  数据:"+a),u.e("指令发送成功:"+a,!1,!1,!0)):(t("log","at utils/BleKeyFun-utils-single.js:837","!!!指令发送失败:"+i+"  数据:"+a),u.e("!!!指令发送失败:"+a,!1,!1,!0))}))}),10)}(e)},DEFAULT_BLUETOOTH_STATE:k,getBLEConnectionState:function(){return b},getBLEConnectionID:function(){return w},makePair:function(){uni.makeBluetoothPair({deviceId:F,timeout:2e4,success:function(e){t("log","at utils/BleKeyFun-utils-single.js:852",e)},fail:function(e){t("log","at utils/BleKeyFun-utils-single.js:855",e)}})},saveBLEDeviceInfo:z,getBLEDeviceInfo:function(e,n){t("log","at utils/BleKeyFun-utils-single.js:879","getBLEDeviceInfo"),uni.getStorage({key:e,success:function(e){var i=JSON.parse(e.data);t("log","at utils/BleKeyFun-utils-single.js:885",F=i.deviceId),t("log","at utils/BleKeyFun-utils-single.js:887",p=i.readServiceUUID),t("log","at utils/BleKeyFun-utils-single.js:889",h=i.writeServiceUUID),t("log","at utils/BleKeyFun-utils-single.js:891",T=i.readCharacUUID),t("log","at utils/BleKeyFun-utils-single.js:893",y=i.writeCharacUUID),t("log","at utils/BleKeyFun-utils-single.js:895",B=i.randomCharacUUID),n(!0,i)},fail:function(e){t("log","at utils/BleKeyFun-utils-single.js:900",e),n(!1)}})},clrBLEDeviceInfo:function(e){t("log","at utils/BleKeyFun-utils-single.js:907","clrBLEDeviceInfo"),uni.removeStorage({key:e,success:function(){}})},connectBLEConnected:function(e,t,n){!function(e,t,n,i){P((function(i){i?H((function(i){i?function(e,t,n,i,o){L!=i&&(L=i),O!=o&&(O=o),w!=e&&(w=e),W()}(e,0,0,t,n):(t(k.BLUETOOTH_ERROR),t(k.BLUETOOTH_ADAPTER_UNAVAILABLE))})):(t(k.BLUETOOTH_ERROR),t(k.BLUETOOTH_UNSUPPORTED))}))}(e,t,n)}},X={url:"",method:"GET",timeout:1e4,loading:!0};const Q=new class{constructor(e){this.baseURL=e.baseURL,this.interceptor={}}setInterceptor(e){this.interceptor=e}async request(e){let n={...X,...e};"function"==typeof this.interceptor.request&&(n=this.interceptor.request(n));let i=this.baseURL+n.url;if(n.params){i+=`?${new URLSearchParams(n.params).toString()}`}try{let e=n.data||{};if(n.isFormData){const t={};for(const n in e)e.hasOwnProperty(n)&&(t[n]=String(e[n]));e=t}t("log","at utils/request/http.js:65","发送请求:",{url:i,method:n.method,data:e,header:n.header});const o=await uni.request({url:i,method:n.method,data:e,header:n.header,timeout:n.timeout});let a=o;return"function"==typeof this.interceptor.response&&(a=this.interceptor.response(o)),200===a.statusCode?a.data:(t("error","at utils/request/http.js:90","接口返回异常:",a),Promise.reject(a.data))}catch(o){return t("error","at utils/request/http.js:95","请求异常:",o),this.handleError(o),Promise.reject(o)}finally{n.loading&&uni.hideLoading()}}handleError(e){const n=e.errMsg||"";n.includes("timeout")?uni.showToast({title:"请求超时",icon:"none"}):n.includes("abort")?t("log","at utils/request/http.js:115","请求被取消"):uni.showToast({title:"网络异常，请稍后重试",icon:"none"})}get(e,t,n){return this.request({...n,url:e,method:"GET",params:t})}post(e,t,n){return this.request({...n,url:e,method:"POST",data:t})}postFormData(e,t,n){return this.request({...n,url:e,method:"POST",data:t,isFormData:!0})}put(e,t,n){return this.request({...n,url:e,method:"PUT",data:t})}delete(e,t,n){return this.request({...n,url:e,method:"DELETE",params:t})}}({baseURL:"https://k1sw.wiselink.net.cn"});Q.get=(e,t,n)=>Q.request({...n,url:e,method:"GET",params:t}),Q.post=(e,t,n)=>Q.request({...n,url:e,method:"POST",data:t}),Q.postFormData=(e,t,n)=>Q.request({...n,url:e,method:"POST",data:t,isFormData:!0}),Q.put=(e,t,n)=>Q.request({...n,url:e,method:"PUT",data:t}),Q.delete=(e,t,n)=>Q.request({...n,url:e,method:"DELETE",params:t}),Q.setInterceptor({request:e=>{const t=uni.getStorageSync("token");let n=e.header||{};return t&&(n.token=t),e.isFormData?n["content-type"]="application/x-www-form-urlencoded":n["content-type"]="application/json",e.header=n,e},response:e=>(9e3===e.data.code&&uni.navigateTo({url:"/pages/login/login"}),e)});const Z=3,ee=4,te=5,ne=6,ie=7;__definePage("pages/index/index",((e,t)=>{const n=e.__vccOpts||e;for(const[i,o]of t)n[i]=o;return n})({data:()=>({latitude:39.90469,longitude:116.40717,markers:[{id:1,latitude:39.90469,longitude:116.40717,title:"天安门",callout:{content:"这里是天安门",display:"ALWAYS"}}],entries:[{text:"开锁",icon:"/static/lock.png",evt:"handleUnlock"},{text:"关锁",icon:"/static/unlock.png",evt:"handleLock"},{text:"寻车",icon:"/static/xunche.png",evt:"handleFindCar"},{text:"尾箱",icon:"/static/weixiang.png",evt:"handleOpenTrunk"},{text:"升窗",icon:"/static/sc.png",evt:"handleRaiseTheWindow"},{text:"降窗",icon:"/static/jc.png",evt:"handleLowerTheWindow"},{text:"左中门",icon:"/static/zm.png"},{text:"右中门",icon:"/static/ym.png"}],itemsPerPage:4,current:0,screenInfo:{},connectionState:"未连接",connectionID:""}),async onLoad(){this.isLoading=!0,uni.hideTabBar({animation:!0});try{await Promise.allSettled([this.initialScreenInfo()])}catch(e){t("error","at pages/index/index.vue:224","初始化失败:",e)}finally{this.isLoading=!1}this.getLocation()},onShow:function(){this.initialScreenInfo(),this.handleStart(),this.startConnectionStatusPolling()},computed:{pages(){const e=[],t=this.entries.length;for(let n=0;n<t;n+=this.itemsPerPage)e.push(this.entries.slice(n,n+this.itemsPerPage));return e},containerStyle(){return t("log","at pages/index/index.vue:248",this.screenInfo),{height:`${this.screenInfo.screenHeight||667}px`}},navbarStyle(){return{marginTop:`${this.screenInfo.statusBarHeight}px`}}},methods:{async initialScreenInfo(){try{this.screenInfo=await new Promise(((e,n)=>{uni.getSystemInfo({success:function(n){t("log","at utils/scheme/screen.js:10","屏幕可用高度:",n.windowHeight),e(n)},fail:function(e){t("error","at utils/scheme/screen.js:14","获取系统信息失败",e),n(e)}})}))}catch(e){uni.showToast({title:"设备信息获取失败",icon:"none"})}},startConnectionStatusPolling(){this.pageInterval||(this.pageInterval=setInterval((()=>{const e=J.getBLEConnectionState(),t=e?J.getBLEConnectionID():"";this.connectionState=e?"已连接":"未连接",this.connectionID=t}),200))},handleStart(){const e={sn:"19585080015",bluetoothKey:"333688439194"};if(e){if(this.deviceIDC=e.sn,e.bluetoothKey){const t=e.bluetoothKey.toString(),n=[];for(let e=0;e<t.length;e+=2){const i=t.substring(e,e+2);n.push(parseInt(i,16))}this.orgKey=n}this.orgKeyOld=e.bluetoothKey,this.bluetoothData=e,setTimeout((()=>{J.connectBLE(this.deviceIDC,(e=>{this.bluetoothStateMonitor(e)}),((e,t,n,i)=>{this.bluetoothDataMonitor(e,t,n,i)}))}),100)}},bluetoothStateMonitor(e){const n=e=>{uni.hideLoading(),uni.showToast({title:e,icon:"none",duration:3e3,mask:!0})},i={[J.DEFAULT_BLUETOOTH_STATE.BLUETOOTH_PRE_EXECUTE]:()=>{uni.showLoading({title:"加载中...",mask:!0})},[J.DEFAULT_BLUETOOTH_STATE.BLUETOOTH_ERROR]:()=>{uni.hideLoading()},[J.DEFAULT_BLUETOOTH_STATE.BLUETOOTH_ADAPTER_UNAVAILABLE]:()=>{n("请打开蓝牙")},[J.DEFAULT_BLUETOOTH_STATE.BLUETOOTH_NOT_FOUND]:()=>{n("没有发现设备")},[J.DEFAULT_BLUETOOTH_STATE.BLUETOOTH_CONNECT_FAILED]:()=>{n("蓝牙连接失败")},[J.DEFAULT_BLUETOOTH_STATE.BLUETOOTH_UNSUPPORTED]:()=>{n("您的手机不支持低功耗蓝牙")},[J.DEFAULT_BLUETOOTH_STATE.BLUETOOTH_SEND_FAILED]:()=>{n("数据发送失败")},[J.DEFAULT_BLUETOOTH_STATE.BLUETOOTH_NO_RESPONSE]:()=>{n("设备超时无响应")},[J.DEFAULT_BLUETOOTH_STATE.BLUETOOTH_CONNECT_SUCESS]:()=>{((e="操作成功")=>{uni.hideLoading(),uni.showToast({title:e,icon:"none",duration:2e3})})("连接成功")}}[e];i?i():(t("warn","at pages/index/index.vue:382","未知的蓝牙状态:",e),uni.hideLoading())},bluetoothDataMonitor:function(e,t,n,i){const o=i||"";0===e&&(this.btnCmdSend(16,t),setTimeout((()=>{this.PackAndSend(16,8,[0,0,0,0,0,0,0,0])}),1e3)),this.parseData(this.trimHexData(o))},parseEventDynamicCode(e,t){this.handleEvent(t)},handleEvent(e){const t={handleUnlock:()=>{this.sendVehicleCommandFun(Z,"")},handleLock:()=>{this.sendVehicleCommandFun(ee,"")},handleOpenTrunk:()=>{this.sendVehicleCommandFun(te,"")},handleFindCar:()=>{this.sendVehicleCommandFun(ne,"")},handleRaiseTheWindow:()=>{this.sendVehicleCommandFun(ie,WindowAction.RAISE)},handleLowerTheWindow:()=>{this.sendVehicleCommandFun(ie,WindowAction.LOWER)}}[e];"function"==typeof t&&t()},sendVehicleCommandFun:function(e,t){"已连接"!=this.connectionState?"未连接"!=this.connectionState||uni.showToast({title:"请等待蓝牙连接后重试",icon:"none"}):uni.showModal({title:"提示",content:3==e||4==e?"确认下发指令":"如原车钥匙不支持此功能请自行点击【更多钥匙功能】关闭",confirmText:3==e||4==e?"确认":"确认支持",complete:n=>{n.confirm&&(uni.showLoading({title:"加载中...",mask:!0}),this.btnCmdSend(e,t),setTimeout((()=>{uni.hideLoading()}),1e3),this.handleSendInfo(e,t))}})},handleSendInfo(e,t){var n;this.deviceIDC,null==(n=null==this?void 0:this.parsedData)||n.electric},auth_encrypt:function(e,t){for(var n=[0,0,0,0,0,0,0,0],i=0;i<6;i++)n[i]=e[i]^t[i]^255;return n},btnCmdSend:function(e,t){const n=this,i=[0,0,0,0,0,0,0,0];switch(e){case 16:const o=this.orgKey;n.PackAndSend(e,8,n.auth_encrypt(o,t));break;case 3:case 4:case 5:case 6:n.PackAndSend(e,8,i);break;case 34:n.PackAndSend(e,8,t);break;case 7:n.PackAndSend07(e,8,t);break;case 58:const a=t;this.PackAndSend3a(e,12,a)}},PackAndSend:function(e,t,n){var i=[36,e,t,...n,36];J.dispatcherSend2(this.arrayToArrayBuffer(i))},PackAndSend3a(e,t,n,i){const o=[36],a=[36],s=[...n].concat(new Array(t-n.length).fill(0)).slice(0,t),r=8==t?[...o,e,t,...n,...a]:[...o,e,...s,...a];J.dispatcherSend2(this.arrayToArrayBuffer(r))},PackAndSend07:function(e,t,n){var i=[36,e,t,n,0,0,0,0,0,0,0,36];J.dispatcherSend2(this.arrayToArrayBuffer(i))},arrayToArrayBuffer:function(e,t=1){const n=new Uint8Array(e.length*t);return e.forEach(((e,i)=>n[i*t]=e)),n.buffer},initVoltage(e){const t=[4,3.9,3.8,3.7,3.6,3.5,3.4,3.3,3.2,3.1].findIndex((t=>e>=t));return-1!==t?[100,90,80,70,60,50,40,30,20,10][t]:0},getBatteryImage(e){const t=[{min:75,value:"100"},{min:50,value:"75"},{min:25,value:"50"},{min:10,value:"25"}].find((t=>e>t.min))||{value:"0"};this.voltage_image=t.value},getBatteryLevel(e){this.getBatteryImage(e);const t=[90,80,70,60,50,40,30,20,10,5].findIndex((t=>e>t));return-1!==t?["100","90","80","70","60","50","40","30","20","10"][t]:"1"},parseHexDataObject:function(e){if(30!==e.length)return null;const t=[];for(let i=0;i<30;i+=2)t.push(parseInt(e.substr(i,2),16));const n={};return n.lock=1===t[2],n.voltage=(t[12]/10).toFixed(1),n.electric=this.getBatteryLevel(this.initVoltage((t[12]/10).toFixed(1))),n.supply=t[3],n.induction=1===t[0]?"感应模式":"手动模式",n},parseData:function(e){const t=this.parseHexDataObject(e);t&&(this.parsedData=t)},trimHexData:function(e){if("string"!=typeof e||!/^[0-9a-fA-F]+$/.test(e))throw new Error("无效的16进制字符串");return e.slice(4,-2)},onSwiperChange(e){this.current=e.detail.current},getLocation(){uni.getLocation({type:"gcj02",success:e=>{this.latitude=e.latitude,this.longitude=e.longitude,this.markers[0].latitude=e.latitude,this.markers[0].longitude=e.longitude,this.markers[0].title="当前位置",this.markers[0].callout.content="你在这里"},fail:e=>{t("error","at pages/index/index.vue:679","获取位置失败",e),uni.showToast({title:"定位失败",icon:"none"})}})},onRegionChange(e){t("log","at pages/index/index.vue:688","地图区域变化",e)}}},[["render",function(t,n,i,o,a,s){return e.openBlock(),e.createElementBlock("section",{class:"control_container",style:e.normalizeStyle(s.containerStyle),onTouchmove:n[2]||(n[2]=e.withModifiers((()=>{}),["prevent"]))},[e.createElementVNode("view",{class:"control_title",style:e.normalizeStyle(s.navbarStyle)},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("view",{class:"title"},[e.createTextVNode(" 雅迪王 "),e.createElementVNode("text",{style:{"font-size":"16px"}},"京AYU76G")]),e.createElementVNode("view",{class:"icons-container"},[e.createElementVNode("image",{src:"/static/set_up.png",class:"icon"})])]),e.createElementVNode("view",{class:"subtitle"},[e.createElementVNode("text",null,"已关锁"),e.createElementVNode("text",{class:"location-divider"},"丨"),e.createElementVNode("text",null,"北京市丰台区海鹰大厦")])],4),e.createElementVNode("view",{class:"control_car_picture"},[e.createElementVNode("map",{id:"myMap",scale:20,class:"map",latitude:a.latitude,longitude:a.longitude,markers:a.markers,"show-location":"",onRegionchange:n[0]||(n[0]=(...e)=>s.onRegionChange&&s.onRegionChange(...e))},[e.createElementVNode("cover-view",{class:"map_control"},[e.createElementVNode("cover-image",{src:"已连接"==a.connectionState?"/static/bluetooth_select.png":"/static/bluetooth.png",class:"map_image"},null,8,["src"])])],40,["latitude","longitude","markers"])]),e.createElementVNode("view",{class:"control_quick-entry"},[e.createElementVNode("swiper",{class:"entry-swiper","indicator-dots":!1,"indicator-color":"rgba(0, 0, 0, .3)","indicator-active-color":"#ffffff",autoplay:!1,interval:3e3,duration:500,circular:!1,vertical:!1,onChange:n[1]||(n[1]=(...e)=>s.onSwiperChange&&s.onSwiperChange(...e))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.pages,((t,n)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:n},[e.createElementVNode("view",{class:"entry-page"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t,((t,n)=>(e.openBlock(),e.createElementBlock("view",{key:n,class:"entry-item",onClick:e=>s.parseEventDynamicCode(e,t.evt)},[e.createElementVNode("image",{src:t.icon,class:"entry-icon",mode:"aspectFit"},null,8,["src"]),e.createElementVNode("text",{class:"entry-text"},e.toDisplayString(t.text),1)],8,["onClick"])))),128))])])))),128))],32),e.createElementVNode("view",{class:"custom-indicator"},e.toDisplayString(a.current+1)+" / "+e.toDisplayString(s.pages.length),1)]),e.createElementVNode("view",{class:"control_info-root"},[e.createElementVNode("view",{class:"control_info-left-card"},[e.createElementVNode("view",{class:"control_info-corner control_info-top-left"},[e.createElementVNode("text",{class:"control_info-date"},"29天前"),e.createElementVNode("text",{class:"control_info-label"},"上次充电")]),e.createElementVNode("view",{class:"control_info-corner control_info-top-right"},[e.createElementVNode("text",{class:"control_info-battery-value"},[e.createTextVNode(" 72"),e.createElementVNode("text",{class:"control_info-battery-unit"},"%")])]),e.createElementVNode("view",{class:"control_info-corner control_info-bottom-left"},[e.createElementVNode("text",{class:"control_info-label"},"21天"),e.createElementVNode("text",{class:"control_info-date"},"已用天数")]),e.createElementVNode("view",{class:"control_info-corner control_info-bottom-right"},[e.createElementVNode("text",{class:"control_info-label"},"10天"),e.createElementVNode("text",{class:"control_info-date"},"可用天数")])]),e.createElementVNode("view",{class:"control_info-right-container"},[e.createElementVNode("view",{class:"control_info-right-item"},[e.createElementVNode("image",{src:"/static/gy.png",class:"control_info-icon"}),e.createElementVNode("view",{class:"control_car_text"},[e.createElementVNode("text",{class:"control_info-title"},"感应模式"),e.createElementVNode("text",{class:"control_info-status"},"未开启")])]),e.createElementVNode("view",{class:"control_info-right-item"},[e.createElementVNode("image",{src:"/static/clzx.png",class:"control_info-icon"}),e.createElementVNode("text",{class:"control_info-title"},"车辆中心")])])]),this.screenInfo.screenHeight>600?(e.openBlock(),e.createElementBlock("view",{key:0,class:"control_footer"},[e.createElementVNode("view",{class:"footer-content"},[e.createElementVNode("view",{class:"footer-item"},[e.createElementVNode("text",{class:"footer-title"},"连接状态："),e.createElementVNode("text",{class:"footer-info"},"当地图上蓝牙图标呈蓝色高亮时，表示车辆已就绪，可进行操控")]),e.createElementVNode("view",{class:"footer-item"},[e.createElementVNode("text",{class:"footer-title"},"位置信息："),e.createElementVNode("text",{class:"footer-info"},"当前显示为车辆上一次蓝牙连接时的最后记录位置")]),e.createElementVNode("view",{class:"footer-item"},[e.createElementVNode("text",{class:"footer-title"},"操控区域："),e.createElementVNode("text",{class:"footer-info"},"基础控制功能适用于全部车型，高级功能仅支持高配版及商务车型")]),e.createElementVNode("view",{class:"footer-item"},[e.createElementVNode("text",{class:"footer-title"},"电量信息："),e.createElementVNode("text",{class:"footer-info"},"蓝牙连接后同步获取，可用天数预估基于本次充电后的实际用车习惯动态计算")]),e.createElementVNode("view",{class:"footer-item"},[e.createElementVNode("text",{class:"footer-title"},"感应模式："),e.createElementVNode("text",{class:"footer-info"},"需在设置中完成蓝牙配对后方可启用（仅限车主账户操作）")])])])):e.createCommentVNode("",!0)],36)}],["__scopeId","data-v-609bd3f3"]]));const oe={onLaunch:function(){t("log","at App.vue:4","App Launch")},onShow:function(){t("log","at App.vue:7","App Show")},onHide:function(){t("log","at App.vue:10","App Hide")}};const{app:ae,Vuex:se,Pinia:re}={app:e.createVueApp(oe)};uni.Vuex=se,uni.Pinia=re,ae.provide("__globalStyles",__uniConfig.styles),ae._component.mpType="app",ae._component.render=()=>{},ae.mount("#app")}(Vue);
